<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="icon" type="image/png" href="images/USDS.png">
    <title>Proposal Submission Form</title>
    <style>
        :root {
            --primary-color: #2c3e50; /* Navbar and Sidebar */
            --secondary-color: #c0392b; /* Go Back button (matches Logout) */
            --item-highlight: #2980b9; /* Submit button */
            --sidebar-width: 250px;
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
        }

        .navbar {
            background-color: var(--primary-color);
            color: white;
            height: var(--header-height);
            position: fixed;
            width: 100%;
            top: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            flex-wrap: wrap; /* Allow wrapping if needed */
            min-height: var(--header-height);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            flex: 1; /* Allow it to take available space */
            min-width: 0; /* Prevent overflow */
        }

        .toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 10px;
            margin-right: 10px;
        }

        .navbar h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 500;
            color: white;
        }

        .datetime {
            font-size: 1rem;
            padding: 8px 15px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 50%;
        }

        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary-color);
            color: white;
            position: fixed;
            height: calc(100% - var(--header-height));
            top: var(--header-height);
            left: 0;
            padding-top: 20px;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li a {
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            display: block;
            transition: all 0.3s ease;
        }

        .sidebar ul li a:not(.logout-btn):hover {
            background-color: var(--item-highlight);
            padding-left: 25px;
        }

        .sidebar ul li a:not(.logout-btn).active {
            background-color: var(--item-highlight);
            padding-left: 25px;
            font-weight: 600;
        }

        .sidebar ul li a.logout-btn:hover {
            background-color: var(--secondary-color);
            padding-left: 25px;
        }

        .sidebar ul li a.logout-btn.active {
            background-color: var(--secondary-color);
            padding-left: 25px;
            font-weight: 600;
        }

        .main-content {
            margin-left: 0;
            margin-top: var(--header-height);
            padding: 20px;
            width: 100%;
            transition: margin-left 0.3s ease;
        }

        .main-content.sidebar-active {
            margin-left: var(--sidebar-width);
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1400px;
        }

        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
            font-size: 1.75rem;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.125rem;
            color: #555;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--item-highlight);
            display: inline-block;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
        }

        label {
            font-weight: bold;
            color: #444;
            display: block;
            margin-bottom: 5px;
            font-size: 0.875rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.875rem;
            background-color: #fafafa;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--item-highlight);
            outline: none;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .error {
            color: var(--secondary-color);
            font-size: 0.75rem;
            margin-top: 5px;
        }

        .button-row {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .submit-btn {
            background-color: var(--item-highlight);
            color: white;
        }

        .submit-btn:hover {
            background-color: #1f6692;
        }

        .back-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .back-btn:hover {
            background-color: #a93226;
        }

        @media (max-width: 480px) {
            .navbar {
                flex-direction: column;
                align-items: flex-start;
                padding: 5px 10px;
                height: auto;
            }

            .navbar-brand {
                width: 100%;
                justify-content: space-between;
            }

            .toggle-btn {
                padding: 0 5px;
                font-size: 1.2rem;
            }

            .navbar h1 {
                font-size: 1rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex-grow: 1;
            }

            .datetime {
                font-size: 0.7rem;
                padding: 4px 8px;
                margin-top: 5px;
                max-width: 100%;
                text-align: right;
            }

            .sidebar {
                width: 100%;
            }

            .main-content {
                margin-top: var(--header-height);
            }

            .main-content.sidebar-active {
                margin-left: 0;
            }

            .container {
                padding: 15px;
                max-width: 100%;
            }

            h2 {
                font-size: 1.25rem;
                margin-bottom: 15px;
            }

            .form-section {
                margin-bottom: 20px;
            }

            .section-title {
                font-size: 1rem;
            }

            .form-row {
                flex-direction: column;
                gap: 15px;
            }

            .form-group {
                min-width: 100%;
            }

            label, input, select, textarea {
                font-size: 0.8125rem;
            }

            textarea {
                min-height: 80px;
            }

            .button-row {
                flex-direction: column;
                gap: 10px;
            }

            button {
                width: 100%;
                padding: 10px;
                font-size: 0.875rem;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .navbar {
                flex-wrap: nowrap;
            }

            .datetime {
                font-size: 0.9rem;
                padding: 6px 10px;
                max-width: 40%;
            }

            .navbar h1 {
                font-size: 1.3rem;
            }

            .sidebar {
                width: 200px;
            }

            .main-content.sidebar-active {
                margin-left: 200px;
            }

            .container {
                padding: 20px;
                max-width: 700px;
            }

            h2 {
                font-size: 1.5rem;
            }

            .form-row {
                flex-direction: column;
                gap: 15px;
            }

            .form-group {
                min-width: 100%;
            }

            button {
                padding: 10px 20px;
            }
        }

        @media (min-width: 769px) and (max-width: 1200px) {
            .container {
                max-width: 1000px;
            }

            h2 {
                font-size: 1.75rem;
            }

            .form-group {
                min-width: 280px;
            }

            .form-row {
                gap: 15px;
            }
        }

        @media (min-width: 1201px) {
            .container {
                max-width: 1400px;
                padding: 35px;
            }

            h2 {
                font-size: 2rem;
            }

            .section-title {
                font-size: 1.25rem;
            }

            .form-group {
                min-width: 300px;
            }

            label, input, select, textarea {
                font-size: 1rem;
            }

            button {
                padding: 14px 28px;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="navbar-brand">
            <button class="toggle-btn" onclick="toggleSidebar()">☰</button>
            <h1>Proposal Submission</h1>
        </div>
        <div class="datetime" id="datetime"></div>
    </div>

    <div class="sidebar" id="sidebar">
        <ul>
            <li><a href="dashboard.html" data-page="dashboard.html">Dashboard</a></li>
            <li><a href="report_generation.html" data-page="report_generation.html">Reports</a></li>
            <li><a href="https://docs.google.com/spreadsheets/d/1T5qHMQAFBd1c6ZJOF91v3moXKI5rhpvKL68u3mrjplc/edit?usp=sharing" target="_blank" data-page="sheets">Sheets</a></li>
            <li><a href="#" class="logout-btn" onclick="showLogoutModal()">Logout</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="container">
            <h2>Proposal Submission</h2>
            <form id="proposalForm">
                <input type="hidden" name="type" value="proposal">

                <div class="form-section">
                    <div class="section-title">Proposal Identification</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="proposalId">Proposal ID (Leave blank to auto-generate):</label>
                            <input type="text" id="proposalId" name="proposalId" placeholder="Enter Proposal ID (MM-YYYY-XXXX e.g., 01-2025-0003)">
                            <div id="proposalIdError" class="error"></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Activity Details</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="particulars">Title of Activity:</label>
                            <textarea id="particulars" name="particulars" placeholder="Enter title..." required></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Implementing Unit</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="college">College:</label>
                            <select id="college" name="college" onchange="updateDepartments()">
                                <option value="">Select College</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="department">Department:</label>
                            <select id="department" name="department">
                                <option value="">Select Department</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="others">If others, please specify:</label>
                            <input type="text" id="others" name="others" placeholder="Specify if others">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Basic Information of the Activity</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="objectives">Objectives:</label>
                            <textarea id="objectives" name="objectives" placeholder="Enter objectives..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="nature">Nature/Classification:</label>
                            <select id="nature" name="nature" required>
                                <option value="" disabled selected>Select Nature/Classification</option>
                                <option value="Off Campus">Off Campus</option>
                                <option value="In Campus">In Campus</option>
                                <option value="OJT">OJT</option>
                                <option value="USC">USC</option>
                                <option value="UNIBE">UNIBE</option>
                                <option value="UBO">UBO</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="locale">Locale:</label>
                            <input type="text" id="locale" name="locale" placeholder="Enter locale" required>
                        </div>
                        <div class="form-group">
                            <label for="durationOfActivity">Duration of Activity:</label>
                            <input type="text" id="durationOfActivity" name="durationOfActivity" placeholder="Enter duration" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Funding Requirement</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="funding">Funding Source:</label>
                            <input type="text" id="funding" name="funding" placeholder="Enter funding source" required>
                        </div>
                        <div class="form-group">
                            <label for="amount">Total Amount:</label>
                            <input type="number" id="amount" name="amount" step="0.01" placeholder="Enter amount" required>
                            <div id="amountError" class="error"></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Contact and Documents</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contact">Number/Email of Contact Person:</label>
                            <input type="text" id="contact" name="contact" placeholder="Enter contact info" required>
                        </div>
                        <div class="form-group">
                            <label for="documents">Scanned Copy of Documents:</label>
                            <input type="text" id="documents" name="documents" placeholder="URL or file reference">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">1st Evaluation & Review of Compliance</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="csac">Action of CSAC:</label>
                            <input type="text" id="csac" name="csac" placeholder="Enter CSAC action">
                        </div>
                        <div class="form-group">
                            <label for="remarks">Remarks:</label>
                            <textarea id="remarks" name="remarks" placeholder="Enter remarks"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Received by USDS</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="docSeq">DOC. SEQ. No.:</label>
                            <input type="text" id="docSeq" name="docSeq" placeholder="Enter sequence number" required>
                            <div id="docSeqError" class="error"></div>
                        </div>
                        <div class="form-group">
                            <label for="copies">No of Copies:</label>
                            <input type="number" id="copies" name="copies" min="1" placeholder="Enter number of copies" required>
                            <div id="copiesError" class="error"></div>
                        </div>
                        <div class="form-group">
                            <label for="receiver">Receiver:</label>
                            <select id="receiver" name="receiver">
                                <option value="" disabled selected>Select receiver</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dateTime">Date & Time Received (Manila Time):</label>
                            <input type="datetime-local" id="dateTime" name="dateTime" required>
                            <div id="dateTimeError" class="error"></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">2nd Evaluation & Review of Compliance</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="usds">Action of USDS:</label>
                            <select id="usds" name="usds">
                                <option value="" disabled selected>Select USDS Action</option>
                                <option value="Favorably Forwarded to">Favorably Forwarded to</option>
                                <option value="Returned for Compliance">Returned for Compliance</option>
                                <option value="Pending Review">Pending Review</option>
                                <option value="Approved">Approved</option>
                                <option value="Disapproved">Disapproved</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="notations">Notations:</label>
                            <textarea id="notations" name="notations" placeholder="Enter notations"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="status">Status:</label>
                            <select id="status" name="status">
                                <option value="">Select Status</option>
                                <option value="Pending">Pending</option>
                                <option value="Returned">Returned</option>
                                <option value="Forwarded">Forwarded</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="statusDate">Status Date & Time (Manila Time):</label>
                            <input type="datetime-local" id="statusDate" name="statusDate">
                            <div id="statusDateError" class="error"></div>
                        </div>
                        <div class="form-group">
                            <label for="returnedDate">Returned Date & Time (if applicable, Manila Time):</label>
                            <input type="datetime-local" id="returnedDate" name="returnedDate">
                            <div id="returnedDateError" class="error"></div>
                        </div>
                        <div class="form-group">
                            <label for="officeDestination">Office Destination:</label>
                            <input type="text" id="officeDestination" name="officeDestination" placeholder="Enter office destination">
                        </div>
                    </div>
                </div>

                <div class="button-row">
                    <button type="submit" class="submit-btn">Submit</button>
                    <button type="button" class="back-btn" onclick="goBack()">Go Back</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbyHKJ6-qlH4F3dLdUNuu2mcyiQHhv7kTd7cfWnqustB9nD3aquVk0xkmmp4t7Uj620/exec';
        const DASHBOARD_URL = 'dashboard.html';
        const INDEX_URL = 'index.html';

        if (localStorage.getItem('authToken') !== 'loggedIn') {
            window.location.href = INDEX_URL;
        }

        // Navbar and Sidebar functionality
        function updateDateTime() {
            const now = new Date();
            const isMobile = window.innerWidth <= 480;
            const options = isMobile
                ? { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }
                : { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            document.getElementById('datetime').textContent = now.toLocaleString('en-US', options);
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            sidebar.classList.toggle('active');
            mainContent.classList.toggle('sidebar-active');
        }

        function setActiveSidebarItem() {
            const sidebarItems = document.querySelectorAll('.sidebar ul li a');
            const currentPage = window.location.pathname.split('/').pop() || 'add.html';
            
            sidebarItems.forEach(item => {
                const page = item.getAttribute('data-page');
                if (page !== 'sheets' && (page === currentPage)) {
                    item.classList.add('active');
                }
                item.addEventListener('click', function(e) {
                    sidebarItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        function showLogoutModal() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                window.location.href = INDEX_URL;
            }
        }

        window.onload = function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            setActiveSidebarItem();
        };

        const collegeData = {
            "BU COLLEGE OF EDUCATION (BUCE)": [
                "Bachelor of Culture and Arts Education (BCAEd)",
                "Bachelor of Early Childhood Education (BECEd)",
                "Bachelor of Elementary Education (BEED)",
                "Bachelor of Secondary Education, major in English (BSED-Eng)",
                "Bachelor of Secondary Education, major in Filipino (BSED-Fil)",
                "Bachelor of Secondary Education, major in Mathematics (BSED-Math)",
                "Bachelor of Secondary Education, major in Science (BSED-Sci)",
                "Bachelor of Secondary Education, major in Social Studies (BSED-SS)",
                "Bachelor of Secondary Education, major in Values Education (BSED-VE)",
                "Certificate in College Teaching (CCT)",
                "Integrated Laboratory High School Department"
            ],
            "BU COLLEGE OF EDUCATION Integrated Laboratory High School Department (BUCEILS)": ["NA"],
            "BU COLLEGE OF SCIENCE (BUCS)": [
                "Bachelor of Science in Biology (BSBio)",
                "Bachelor of Science in Chemistry (BSChem)",
                "Bachelor of Science in Computer Science (BSCS)",
                "Bachelor of Science in Information Technology (BSIT)",
                "Bachelor of Science in Meteorology (BSMet)"
            ],
            "BU COLLEGE OF MEDICINE (BUCM)": ["Doctor of Medicine (MD)"],
            "BU COLLEGE OF ARTS AND LETTERS (BUCAL)": [
                "Bachelor of Arts in Broadcasting (ABBroad)",
                "Bachelor of Arts in Communication (ABComm)",
                "Bachelor of Arts in English Language (ABEngLang)",
                "Bachelor of Arts in Journalism (ABJourn)",
                "Bachelor of Arts in Literature (ABLit)",
                "Bachelor of Performing Arts, major in Theater (BPeA)"
            ],
            "BU JESSIE M. ROBREDO INSTITUTE OF GOVERNANCE AND DEVELOPMENT (BUJMRIGD)": ["Bachelor of Public Administration (BPA)"],
            "BU COLLEGE OF NURSING (BUCN)": ["Bachelor of Science in Nursing (BSN)"],
            "BU COLLEGE OF ENGINEERING (BUCENG)": [
                "Bachelor of Science in Chemical Engineering (BSCheE)",
                "Bachelor of Science in Civil Engineering (BSCE)",
                "Bachelor of Science in Electrical Engineering (BSEE)",
                "Bachelor of Science in Geodetic Engineering (BSGE)",
                "Bachelor of Science in Mechanical Engineering (BSME)",
                "Bachelor of Science in Mining Engineering (BSEM)",
                "Bachelor of Science in Computer Engineering (BSCoE)",
                "Bachelor of Science in Electronics Engineering (BSECE)"
            ],
            "BU INSTITUTE OF DESIGN AND ARCHITECTURE (BUIDeA)": [
                "Bachelor of Science in Architecture (BSArch)",
                "Bachelor in Industrial Design (BID)"
            ],
            "BU INSTITUTE OF P.E., SPORTS AND RECREATION (BUIPESR)": [
                "Bachelor of Physical Education (BPED)",
                "Bachelor of Science in Exercise & Sports Sciences, major in Fitness and Sport Coaching (BSESS-FSC)",
                "Bachelor of Science in Exercise & Sports Sciences, major in Fitness and Sport Management (BSESS-FSM)"
            ],
            "BU COLLEGE OF INDUSTRIAL TECHNOLOGY (BUCIT)": [
                "Bachelor of Science in Accountancy (BSAcct)",
                "Bachelor of Science in Economics (ABEcon)",
                "Bachelor of Science in Entrepreneurship (BSEntrep)",
                "Bachelor of Science in Business Administration (BSBA), major in:",
                "Financial Management (BSBA-FM)",
                "Human Resource Management (BSBA-HRM)",
                "Management (BSBA-Mgt)",
                "Marketing Management (BSBA-MM)",
                "Microfinance (BSBA-MF)",
                "Operations Management (BSBA-OM)"
            ],
            "BU COLLEGE OF BUSINESS, ECONOMICS, AND MANAGEMENT (BUCBEM)": [
                "Bachelor of Science in Accountancy (BSAcct)",
                "Bachelor of Science in Economics (ABEcon)",
                "Bachelor of Science in Entrepreneurship (BSEntrep)",
                "Bachelor of Science in Business Administration (BSBA), major in:",
                "Financial Management (BSBA-FM)",
                "Human Resource Management (BSBA-HRM)",
                "Management (BSBA-Mgt)",
                "Marketing Management (BSBA-MM)",
                "Microfinance (BSBA-MF)",
                "Operations Management (BSBA-OM)"
            ],
            "BU COLLEGE OF SOCIAL SCIENCES AND PHILOSOPHY (BUCSSP)": [
                "Bachelor of Arts in Peace Studies (BAPS)",
                "Bachelor of Arts in Philosophy (ABPhilo)",
                "Bachelor of Arts in Political Science (ABPolSci)",
                "Bachelor of Arts in Sociology (ABSocio)",
                "Bachelor of Science in Psychology (ABPsyc)",
                "Bachelor of Science in Social Work (BSSW)"
            ],
            "BU COLLEGE OF DENTAL MEDICINE (BUDMD)": ["Doctor of Dental Medicine (DMD)"],
            "BU COLLEGE OF LAW": ["Bachelor of Laws (LLB)"],
            "BU GRADUATE SCHOOL": [],
            "BU GUINOBATAN CAMPUS": [
                "Bachelor of Science in Agricultural Engineering (BSABE)",
                "Bachelor of Science in Agriculture, major in:",
                "Animal Science (BSAAS)",
                "Crop Science (BSACS)",
                "Agricultural Extension (BSAAEx)",
                "Agribusiness (BSAgrib)",
                "Agriculture and Biosystems (BSAgrib)",
                "Bachelor of Science in Forestry (BSF)",
                "Bachelor of Science in Fisheries (BSFish)"
            ],
            "BU POLANGUI CAMPUS": [
                "Bachelor of Science in Information System (BSIS)",
                "Bachelor of Science in Information Technology (BSIT)",
                "Bachelor of Science in Information Technology, major in Animation (BSIT-Anim)"
            ],
            "BU TABACO CAMPUS": ["Bachelor of Science in Fisheries (ETEEAP)"],
            "BU GUBAT CAMPUS": ["Bachelor of Science in Nursing (BSN)"],
            "BU TECHNICAL-VOCATIONAL TEACHER EDUCATION (BTVTeD)": [
                "Bachelor in Technical - Vocational Teacher Education (BTVTeD), major in:",
                "Drafting Technology (BTVTeD-DT)",
                "Electrical Technology (BTVTeD-ELT)",
                "Food and Service Management (BTVTeD-FSM)",
                "Garments, Fashion, and Design (BTVTeD-GFD)",
                "Animal Production (BTVTeD-AP)",
                "Agriculture Crop Production (BTVTeD-ACP)"
            ],
            "OTHER PROGRAMS": [
                "Bachelor in Agricultural Technology (BAT)",
                "Bachelor of Technology and Livelihood Education (BTLED)",
                "Bachelor of Technology and Livelihood Education, major in ICT (BTLED-ICT)"
            ]
        };

        function formatToCustomString(date) {
            const options = {
                timeZone: 'Asia/Manila',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            
            const formatter = new Intl.DateTimeFormat('en-US', options);
            const parts = formatter.formatToParts(date);
            
            const month = parts.find(p => p.type === 'month').value;
            const day = parts.find(p => p.type === 'day').value;
            const year = parts.find(p => p.type === 'year').value;
            const hour = parts.find(p => p.type === 'hour').value.padStart(2, '0');
            const minute = parts.find(p => p.type === 'minute').value.padStart(2, '0');
            const second = parts.find(p => p.type === 'second').value.padStart(2, '0');
            const period = parts.find(p => p.type === 'dayPeriod').value;
            
            return `${month}/${day}/${year} @ ${hour}:${minute}:${second} ${period}`;
        }

        function setDateTimeDefault(inputId) {
            const input = document.getElementById(inputId);
            const now = new Date();
            const manilaTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Manila' }));
            const formatted = manilaTime.toISOString().slice(0, 16);
            input.value = formatted;
            return formatToCustomString(manilaTime);
        }

        function validateDateTime(inputId, errorId) {
            const input = document.getElementById(inputId);
            const error = document.getElementById(errorId);
            const value = input.value;
            
            if (value) {
                const date = new Date(value);
                if (isNaN(date.getTime())) {
                    error.textContent = 'Invalid date/time format';
                    return false;
                }
                if (date > new Date()) {
                    error.textContent = 'Date cannot be in the future';
                    return false;
                }
                error.textContent = '';
                return true;
            }
            return !input.required;
        }

        function initializeDateTimeFields() {
            const dateFields = [
                { id: 'dateTime', error: 'dateTimeError', default: false },
                { id: 'statusDate', error: 'statusDateError', default: false },
                { id: 'returnedDate', error: 'returnedDateError', default: false }
            ];

            dateFields.forEach(field => {
                const input = document.getElementById(field.id);
                
                if (field.default) {
                    setDateTimeDefault(field.id);
                }

                input.addEventListener('change', () => {
                    validateDateTime(field.id, field.error);
                });
            });
        }

        function goBack() {
            window.location.href = DASHBOARD_URL;
        }

        function populateColleges() {
            const collegeSelect = document.getElementById('college');
            collegeSelect.innerHTML = '<option value="">Select College</option>';
            Object.keys(collegeData).forEach(college => {
                const option = document.createElement('option');
                option.value = college;
                option.text = college;
                collegeSelect.appendChild(option);
            });
        }

        function updateDepartments() {
            const college = document.getElementById("college").value;
            const departmentSelect = document.getElementById("department");
            departmentSelect.innerHTML = '<option value="">Select Department</option>';
            
            if (college && collegeData[college]) {
                collegeData[college].forEach(dept => {
                    const option = document.createElement("option");
                    option.value = dept;
                    option.text = dept;
                    departmentSelect.appendChild(option);
                });
            }
        }

        async function populateReceiver(silent = false) {
            try {
                const response = await fetch(`${API_URL}?action=getReceivers`, {
                    method: 'GET',
                    redirect: 'follow'
                });
                if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                const receivers = await response.json();
                
                const receiverSelect = document.getElementById('receiver');
                receiverSelect.innerHTML = '<option value="" disabled selected>Select receiver</option>';
                receivers.forEach(receiver => {
                    const option = document.createElement('option');
                    option.value = receiver;
                    option.text = receiver;
                    receiverSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching receivers:', error);
                if (!silent) {
                    alert(`Failed to load receivers: ${error.message}. Using default options.`);
                }
                const defaultReceivers = ["Ma'am Ann", "Sir Ronald", "Sir Mike", "Sir Christian"];
                const receiverSelect = document.getElementById('receiver');
                receiverSelect.innerHTML = '<option value="" disabled selected>Select receiver</option>';
                defaultReceivers.forEach(receiver => {
                    const option = document.createElement('option');
                    option.value = receiver;
                    option.text = receiver;
                    receiverSelect.appendChild(option);
                });
            }
        }

        document.getElementById('proposalForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            let valid = true;

            const proposalId = document.getElementById('proposalId');
            const proposalIdError = document.getElementById('proposalIdError');
            if (proposalId.value && !/^\d{2}-\d{4}-\d{4}$/.test(proposalId.value)) {
                proposalIdError.textContent = 'Proposal ID must be in format MM-YYYY-XXXX (e.g., 01-2025-0003)';
                valid = false;
            } else {
                proposalIdError.textContent = '';
            }

            const amount = document.getElementById('amount');
            const amountError = document.getElementById('amountError');
            if (!amount.value || isNaN(amount.value) || amount.value <= 0) {
                amountError.textContent = 'Total amount must be a positive number.';
                valid = false;
            } else {
                amountError.textContent = '';
            }

            const docSeq = document.getElementById('docSeq');
            const docSeqError = document.getElementById('docSeqError');
            if (!docSeq.value) {
                docSeqError.textContent = 'Please enter a document sequence number.';
                valid = false;
            } else {
                docSeqError.textContent = '';
            }

            const copies = document.getElementById('copies');
            const copiesError = document.getElementById('copiesError');
            if (!copies.value || isNaN(copies.value) || copies.value < 1) {
                copiesError.textContent = 'Number of copies must be at least 1.';
                valid = false;
            } else {
                copiesError.textContent = '';
            }

            valid &= validateDateTime('dateTime', 'dateTimeError');
            valid &= validateDateTime('statusDate', 'statusDateError');
            valid &= validateDateTime('returnedDate', 'returnedDateError');

            if (!valid) return;

            const formData = new FormData(this);
            const data = {};
            formData.forEach((value, key) => {
                if (['dateTime', 'statusDate', 'returnedDate'].includes(key) && value) {
                    const date = new Date(value);
                    data[key] = formatToCustomString(date);
                } else {
                    data[key] = value;
                }
            });
            data.action = "add";

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error: ${response.status} - ${errorText}`);
                }
                const result = await response.json();
                console.log('Server response:', result);

                if (result.success) {
                    alert(`Proposal submitted successfully! Proposal ID: ${result.proposalId}`);
                    document.getElementById('proposalForm').reset();
                    populateColleges();
                    updateDepartments();
                    await populateReceiver(true);
                    initializeDateTimeFields();
                    window.location.href = DASHBOARD_URL;
                } else {
                    alert('Failed to submit proposal: ' + result.message);
                }
            } catch (error) {
                console.error('Submission error:', error);
                alert('Error submitting proposal: ' + error.message);
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            populateColleges();
            populateReceiver();
            initializeDateTimeFields();
        });
    </script>
</body>
</html>